# DevOpsAssignment: Error Log and Fixes (Last 2 Days)

## 1. ECR Repository Naming Mismatch
- **Error:** ECS Fargate tasks failed with `CannotPullContainerError` due to image not found in ECR. Repo names like `product-management-system-dev-default` were created, but pipeline and ECS expected `product-management-system-dev`.
- **Fix:** Simplified ECR repo naming in `ContainerRegistryStack.cs` to always use `product-management-system-{env}` (e.g., `product-management-system-dev`), removing any `-default` or extra suffix logic.

## 2. ECR Image Deletion in Cleanup
- **Error:** Cleanup job failed to delete ECR images due to incorrect usage of `--image-ids` (JSON parsing error).
- **Fix:** Updated both `pipeline.yaml` and `cleanup.yaml` to always write image IDs to a file and use `--image-ids file://image_ids.json` for robust batch deletion.

## 3. Multi-Region/Multi-Env Pipeline Issues
- **Error:** Resource names and stacks were not unique per environment/region, causing conflicts.
- **Fix:** All resource and stack names now include environment suffixes (e.g., `-dev`, `-prod`).

## 4. CDK Bootstrap Race Condition
- **Error:** CDK stacks failed to deploy if the environment was not bootstrapped.
- **Fix:** Added a bootstrap job in the pipeline to ensure all regions/environments are bootstrapped before deployment.

## 5. ECS Image Tag Consistency
- **Error:** ECS task definition sometimes referenced a tag that was not pushed to ECR.
- **Fix:** Pipeline and CDK now consistently use `${{ github.sha }}` as the image tag, and ECS stack reads this from the environment.

## 6. Swagger UI Not Always Available
- **Error:** Swagger UI was not always enabled at the root in the .NET app.
- **Fix:** Updated `Program.cs` to always enable Swagger UI at the root path, regardless of environment.

## 7. IAM Permissions for ECS/ECR
- **Error:** ECS tasks failed to pull images due to missing ECR permissions.
- **Fix:** CDK stack grants correct ECR permissions to ECS task execution role.

## 8. Robust Cleanup Logic
- **Error:** Cleanup jobs sometimes failed if ECR repo did not exist or had no images.
- **Fix:** Cleanup jobs now check for repo existence and only attempt deletion if images exist.

---
**All major errors and pipeline issues have been addressed and fixed as of June 16, 2025.**
